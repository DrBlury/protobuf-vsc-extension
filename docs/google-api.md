# Google API Support

This extension provides comprehensive support for Google API annotations and patterns commonly used in gRPC and Cloud API development.

## Features

### HTTP Annotations (`google.api.http`)

The extension provides completions, snippets, and syntax highlighting for HTTP annotations that map gRPC methods to HTTP REST endpoints.

#### Completions

When typing inside an RPC method body, the extension provides completions for:

- **HTTP methods**: `get`, `post`, `put`, `delete`, `patch`, `custom`
- **Body mapping**: `body`, `response_body`
- **Additional bindings**: `additional_bindings`
- **Path templates**: Common patterns with path variables

Example usage:

```proto
import "google/api/annotations.proto";

service UserService {
  rpc GetUser(GetUserRequest) returns (User) {
    option (google.api.http) = {
      get: "/v1/users/{user_id}"  // ← Completions available here
    };
  }

  rpc CreateUser(CreateUserRequest) returns (User) {
    option (google.api.http) = {
      post: "/v1/users"
      body: "user"  // ← Body mapping completion
    };
  }
}
```

#### Snippets

| Prefix | Description |
|--------|-------------|
| `httpget` | HTTP GET mapping for RPC method |
| `httppost` | HTTP POST mapping with request body |
| `httpput` | HTTP PUT mapping for full resource update |
| `httpdelete` | HTTP DELETE mapping |
| `httppatch` | HTTP PATCH mapping for partial updates |
| `httpcustom` | Custom HTTP method mapping |
| `httpbindings` | HTTP mapping with additional bindings |
| `rpcget` | Complete RPC with HTTP GET mapping |
| `rpcpost` | Complete RPC with HTTP POST mapping |
| `rpcdelete` | Complete RPC with HTTP DELETE mapping |
| `rpcpatch` | Complete RPC with HTTP PATCH mapping |
| `rpclist` | Complete RPC with HTTP List mapping |

---

### Field Behavior Annotations (`google.api.field_behavior`)

Annotate fields with behavior hints that indicate how they should be handled by clients and servers.

#### Supported Behaviors

- **REQUIRED**: Field must be set by the client
- **OUTPUT_ONLY**: Field is set by the server, not the client
- **INPUT_ONLY**: Field is set by the client but not returned
- **IMMUTABLE**: Field can only be set once
- **OPTIONAL**: Field is explicitly optional
- **NON_EMPTY_DEFAULT**: Field has a non-empty default
- **IDENTIFIER**: Field uniquely identifies a resource
- **UNORDERED_LIST**: Repeated field values are unordered

#### Example Usage

```proto
import "google/api/field_behavior.proto";

message User {
  // Automatically generated by the server
  string id = 1 [(google.api.field_behavior) = OUTPUT_ONLY];

  // Must be provided by the client
  string email = 2 [(google.api.field_behavior) = REQUIRED];

  // Cannot be changed after creation
  string username = 3 [(google.api.field_behavior) = IMMUTABLE];

  // Optional field
  string display_name = 4 [(google.api.field_behavior) = OPTIONAL];
}
```

#### Snippets

| Prefix | Description |
|--------|-------------|
| `frequiredbehavior` | Field with REQUIRED behavior |
| `foutputonly` | Field with OUTPUT_ONLY behavior |
| `finputonly` | Field with INPUT_ONLY behavior |
| `fimmutable` | Field with IMMUTABLE behavior |

---

### Resource Descriptors (`google.api.resource`)

Define messages as API resources with type, pattern, and naming information.

#### Resource Options

- **type**: Resource type in format `{service}/{resource}`
- **pattern**: Resource name pattern (e.g., `projects/{project}/users/{user}`)
- **name_field**: Field containing the resource name (default: "name")
- **singular**: Singular form of the resource name
- **plural**: Plural form of the resource name
- **history**: Historical versioning behavior
- **style**: Resource style (e.g., DECLARATIVE_FRIENDLY)

#### Example Usage

```proto
import "google/api/resource.proto";

message User {
  option (google.api.resource) = {
    type: "example.googleapis.com/User"
    pattern: "projects/{project}/users/{user}"
    singular: "user"
    plural: "users"
  };

  // Resource name
  string name = 1 [(google.api.field_behavior) = OUTPUT_ONLY];

  // Other fields...
}
```

#### Snippets

| Prefix | Description |
|--------|-------------|
| `resource` | Resource descriptor with type and pattern |
| `resourcenested` | Resource with nested parent pattern |
| `fresourceref` | Field with resource reference |
| `msgresource` | Complete message with resource annotation |

---

### Resource References (`google.api.resource_reference`)

Reference other resources from fields.

#### Example Usage

```proto
import "google/api/resource.proto";

message Order {
  // Reference to the user who placed the order
  string user = 1 [
    (google.api.field_behavior) = REQUIRED,
    (google.api.resource_reference) = {
      type: "example.googleapis.com/User"
    }
  ];
}
```

---

### FieldMask Support

The extension provides enhanced support for `google.protobuf.FieldMask` fields commonly used in update operations.

#### Field Name Suggestions

When using `google.protobuf.FieldMask` as a field type, the extension suggests appropriate field names:

- `update_mask`
- `field_mask`
- `read_mask`
- `output_mask`

#### Snippets

| Prefix | Description |
|--------|-------------|
| `fupdatemask` | FieldMask field for partial updates |
| `msgupdate` | Complete update request message with FieldMask |

#### Example Usage

```proto
import "google/protobuf/field_mask.proto";

message UpdateUserRequest {
  // The user to update
  User user = 1 [(google.api.field_behavior) = REQUIRED];

  // Fields to update
  google.protobuf.FieldMask update_mask = 2;
}
```

---

### Complete Service Example

Here's a complete example of a Google API-style service:

```proto
syntax = "proto3";

package example.v1;

import "google/api/annotations.proto";
import "google/api/client.proto";
import "google/api/field_behavior.proto";
import "google/api/resource.proto";
import "google/protobuf/empty.proto";
import "google/protobuf/field_mask.proto";
import "google/protobuf/timestamp.proto";

option go_package = "example.com/api/v1;v1";

// The User resource
message User {
  option (google.api.resource) = {
    type: "example.googleapis.com/User"
    pattern: "projects/{project}/users/{user}"
  };

  // Resource name
  string name = 1 [(google.api.field_behavior) = OUTPUT_ONLY];

  // User email (required)
  string email = 2 [(google.api.field_behavior) = REQUIRED];

  // Display name
  string display_name = 3;

  // Creation timestamp
  google.protobuf.Timestamp create_time = 4 [(google.api.field_behavior) = OUTPUT_ONLY];

  // Update timestamp
  google.protobuf.Timestamp update_time = 5 [(google.api.field_behavior) = OUTPUT_ONLY];
}

// User service
service UserService {
  option (google.api.default_host) = "api.example.com";
  option (google.api.oauth_scopes) = "https://www.googleapis.com/auth/cloud-platform";

  // Creates a user
  rpc CreateUser(CreateUserRequest) returns (User) {
    option (google.api.http) = {
      post: "/v1/{parent=projects/*}/users"
      body: "user"
    };
    option (google.api.method_signature) = "parent,user";
  }

  // Gets a user
  rpc GetUser(GetUserRequest) returns (User) {
    option (google.api.http) = {
      get: "/v1/{name=projects/*/users/*}"
    };
    option (google.api.method_signature) = "name";
  }

  // Lists users
  rpc ListUsers(ListUsersRequest) returns (ListUsersResponse) {
    option (google.api.http) = {
      get: "/v1/{parent=projects/*}/users"
    };
    option (google.api.method_signature) = "parent";
  }

  // Updates a user
  rpc UpdateUser(UpdateUserRequest) returns (User) {
    option (google.api.http) = {
      patch: "/v1/{user.name=projects/*/users/*}"
      body: "user"
    };
    option (google.api.method_signature) = "user,update_mask";
  }

  // Deletes a user
  rpc DeleteUser(DeleteUserRequest) returns (google.protobuf.Empty) {
    option (google.api.http) = {
      delete: "/v1/{name=projects/*/users/*}"
    };
    option (google.api.method_signature) = "name";
  }
}

message CreateUserRequest {
  string parent = 1 [
    (google.api.field_behavior) = REQUIRED,
    (google.api.resource_reference) = {
      child_type: "example.googleapis.com/User"
    }
  ];
  User user = 2 [(google.api.field_behavior) = REQUIRED];
}

message GetUserRequest {
  string name = 1 [
    (google.api.field_behavior) = REQUIRED,
    (google.api.resource_reference) = {
      type: "example.googleapis.com/User"
    }
  ];
}

message ListUsersRequest {
  string parent = 1 [
    (google.api.field_behavior) = REQUIRED,
    (google.api.resource_reference) = {
      child_type: "example.googleapis.com/User"
    }
  ];
  int32 page_size = 2;
  string page_token = 3;
}

message ListUsersResponse {
  repeated User users = 1;
  string next_page_token = 2;
}

message UpdateUserRequest {
  User user = 1 [(google.api.field_behavior) = REQUIRED];
  google.protobuf.FieldMask update_mask = 2;
}

message DeleteUserRequest {
  string name = 1 [
    (google.api.field_behavior) = REQUIRED,
    (google.api.resource_reference) = {
      type: "example.googleapis.com/User"
    }
  ];
}
```

---

## Required Imports

To use Google API annotations, you need to import the relevant proto files:

```proto
// HTTP annotations for REST mapping
import "google/api/annotations.proto";

// Field behavior annotations
import "google/api/field_behavior.proto";

// Resource definitions
import "google/api/resource.proto";

// Client configuration (default_host, oauth_scopes)
import "google/api/client.proto";

// FieldMask for partial updates
import "google/protobuf/field_mask.proto";
```

These files are available from the [googleapis/googleapis](https://github.com/googleapis/googleapis) repository or through [buf.build](https://buf.build).

---

## Related Documentation

- [AIP (API Improvement Proposals)](https://google.aip.dev/) - Google's API design guidelines
- [googleapis/googleapis](https://github.com/googleapis/googleapis) - Google API proto definitions
- [gRPC-Gateway](https://grpc-ecosystem.github.io/grpc-gateway/) - Generate REST endpoints from gRPC
