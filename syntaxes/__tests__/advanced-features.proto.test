// SYNTAX TEST "source.proto" "Proto2 and Proto3 advanced features - groups, extensions, qualified types"

syntax = "proto2";
// <-- keyword.control.syntax.proto

package advanced;

import "google/protobuf/descriptor.proto";
// <-- keyword.control.import.proto
//                                       ^ punctuation.terminator.proto

// =============================================================================
// EXTENSIONS - Proto2 feature
// =============================================================================

message ExtensibleMessage {
// <--- keyword.declaration.message.proto
    optional string base_field = 1;
//  ^^^^^^^^ keyword.other.modifier.proto
//           ^^^^^^ storage.type.proto
    extensions 100 to 199;
//  ^^^^^^^^^^ keyword.other.extensions.proto
//                 ^^ keyword.other.to.proto
    extensions 1000 to max;
//  ^^^^^^^^^^ keyword.other.extensions.proto
//                     ^^^ keyword.other.max.proto
}

extend ExtensibleMessage {
// <-- keyword.declaration.extend.proto
//     ^^^^^^^^^^^^^^^^^ entity.name.type.proto
    optional string ext_field = 100;
//  ^^^^^^^^ keyword.other.modifier.proto
//           ^^^^^^ storage.type.proto
//                  ^^^^^^^^^ variable.other.field.proto
//                              ^^^ constant.numeric.proto
}


// =============================================================================
// EXTEND WELL-KNOWN OPTIONS
// =============================================================================

extend google.protobuf.FieldOptions {
// <-- keyword.declaration.extend.proto
    optional string custom_option = 50001;
//  ^^^^^^^^ keyword.other.modifier.proto
}

extend google.protobuf.MessageOptions {
    optional bool msg_deprecated = 50002;
//  ^^^^^^^^ keyword.other.modifier.proto
//           ^^^^ storage.type.proto
}


// =============================================================================
// RESERVED with various formats
// =============================================================================

message ReservedMessage {
    reserved 2, 15, 9 to 11;
//  ^^^^^^^^ keyword.other.reserved.proto
//                    ^^ keyword.other.to.proto

    reserved 100 to 199, 1000 to max;
//  ^^^^^^^^ keyword.other.reserved.proto
//               ^^ keyword.other.to.proto
//                            ^^ keyword.other.to.proto
//                               ^^^ keyword.other.max.proto

    reserved "old_field", "removed";
//  ^^^^^^^^ keyword.other.reserved.proto
//           ^^^^^^^^^^^ string.quoted.double.proto
//                        ^^^^^^^^^ string.quoted.double.proto

    optional string active = 1;
//  ^^^^^^^^ keyword.other.modifier.proto
}


// =============================================================================
// GROUPS - Proto2 deprecated syntax
// =============================================================================

message GroupTests {
    optional group SimpleGroup = 1 {
//  ^^^^^^^^ keyword.other.modifier.proto
//           ^^^^^ keyword.declaration.group.proto
//                 ^^^^^^^^^^^ entity.name.type.group.proto
//                             ^ keyword.operator.assignment.proto
//                               ^ constant.numeric.proto
//                                 ^ punctuation.definition.block.proto
        optional string name = 1;
//      ^^^^^^^^ keyword.other.modifier.proto
//               ^^^^^^ storage.type.proto
        optional int32 value = 2;
//      ^^^^^^^^ keyword.other.modifier.proto
//               ^^^^^ storage.type.proto
    }

    repeated group ResultGroup = 2 {
//  ^^^^^^^^ keyword.other.modifier.proto
//           ^^^^^ keyword.declaration.group.proto
//                 ^^^^^^^^^^^ entity.name.type.group.proto
        required string url = 1;
//      ^^^^^^^^ keyword.other.modifier.proto
    }

    required group RequiredGroup = 3 {
//  ^^^^^^^^ keyword.other.modifier.proto
//           ^^^^^ keyword.declaration.group.proto
        required int64 id = 1;
//      ^^^^^^^^ keyword.other.modifier.proto
//               ^^^^^ storage.type.proto
    }
}


// =============================================================================
// QUALIFIED TYPE NAMES
// =============================================================================

message OuterMessage {
    message InnerMessage {
//  ^^^^^^^ keyword.declaration.message.proto
//          ^^^^^^^^^^^^ entity.name.type.message.proto
        message DeepMessage {
//      ^^^^^^^ keyword.declaration.message.proto
//              ^^^^^^^^^^^ entity.name.type.message.proto
            optional string deep_field = 1;
//          ^^^^^^^^ keyword.other.modifier.proto
        }
    }

    enum InnerEnum {
//  ^^^^ keyword.declaration.enum.proto
//       ^^^^^^^^^ entity.name.type.enum.proto
        INNER_UNSPECIFIED = 0;
//      ^^^^^^^^^^^^^^^^^ variable.other.enummember.proto
    }
}

message QualifiedTypes {
    // Relative qualified names
    optional OuterMessage.InnerMessage inner = 1;
//  ^^^^^^^^ keyword.other.modifier.proto
//           ^^^^^^^^^^^^^^^^^^^^^^^^^ entity.name.type.proto
//                                     ^^^^^ variable.other.field.proto

    optional OuterMessage.InnerMessage.DeepMessage deep = 2;
//           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ entity.name.type.proto
//                                                 ^^^^ variable.other.field.proto

    // Absolute qualified names (leading dot)
    optional .advanced.OuterMessage absolute = 3;
//           ^^^^^^^^^^^^^^^^^^^^^^ entity.name.type.proto
//                                  ^^^^^^^^ variable.other.field.proto

    optional .advanced.OuterMessage.InnerMessage abs_inner = 4;
//           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ entity.name.type.proto

    // Well-known types
    optional google.protobuf.FileOptions file_opts = 5;
//           ^^^^^^^^^^^^^^^^^^^^^^^^^^^ entity.name.type.proto
}


// =============================================================================
// HEX FIELD NUMBERS
// =============================================================================

message HexFieldNumbers {
    optional int32 hex_10 = 0x10;
//  ^^^^^^^^ keyword.other.modifier.proto
//           ^^^^^ storage.type.proto
//                 ^^^^^^ variable.other.field.proto
//                        ^ keyword.operator.assignment.proto
//                          ^^^^ constant.numeric.proto

    optional int32 hex_ff = 0xFF;
//                          ^^^^ constant.numeric.proto

    optional int32 hex_upper = 0XAB;
//                             ^^^^ constant.numeric.proto
}


// =============================================================================
// ENUM WITH SPECIAL VALUES
// =============================================================================

enum SpecialEnumValues {
    option allow_alias = true;
//  ^^^^^^ keyword.other.option.proto
//                     ^ keyword.operator.assignment.proto
//                       ^^^^ constant.language.proto

    SPECIAL_UNSPECIFIED = 0;
//  ^^^^^^^^^^^^^^^^^^^ variable.other.enummember.proto
//                      ^ keyword.operator.assignment.proto
//                        ^ constant.numeric.proto

    NEGATIVE_ONE = -1;
//  ^^^^^^^^^^^^ variable.other.enummember.proto
//                 ^ constant.numeric.proto

    NEGATIVE_TEN = -10;
//                 ^^^ constant.numeric.proto

    NEGATIVE_HEX = -0x0A;
//                 ^^^^^ constant.numeric.proto

    HEX_VALUE = 0x10;
//              ^^^^ constant.numeric.proto

    MAX_INT32 = 0x7FFFFFFF;
//              ^^^^^^^^^^ constant.numeric.proto
}


// =============================================================================
// DEFAULT VALUES WITH VARIOUS FORMATS
// =============================================================================

message DefaultValues {
    optional double simple_float = 1 [default = 3.14159];
//  ^^^^^^^^ keyword.other.modifier.proto

    optional double exp_float = 2 [default = 1.5e10];

    optional double neg_exp = 3 [default = -1.5e-10];

    optional double pos_exp = 4 [default = +1.5e+10];

    optional double dot_prefix = 5 [default = .5];

    optional double inf_val = 6 [default = inf];
//                                         ^^^ constant.language.proto

    optional double neg_inf = 7 [default = -inf];

    optional double nan_val = 8 [default = nan];
//                                         ^^^ constant.language.proto

    optional bool bool_default = 9 [default = true];
//                                            ^^^^ constant.language.proto

    optional bool bool_false = 10 [default = false];
//                                           ^^^^^ constant.language.proto
}


// =============================================================================
// RPC WITH STREAMING AND OPTIONS
// =============================================================================

message Request {}
message Response {}

service AdvancedService {
// <--- keyword.declaration.service.proto
//      ^^^^^^^^^^^^^^^ entity.name.type.service.proto

    // Unary RPC
    rpc Unary(Request) returns (Response);
//  ^^^ keyword.declaration.rpc.proto
//      ^^^^^ entity.name.function.rpc.proto
//            ^^^^^^^ entity.name.type.proto
//                     ^^^^^^^ keyword.control.returns.proto
//                              ^^^^^^^^ entity.name.type.proto

    // Server streaming
    rpc ServerStream(Request) returns (stream Response);
//  ^^^ keyword.declaration.rpc.proto
//      ^^^^^^^^^^^^ entity.name.function.rpc.proto
//                                     ^^^^^^ keyword.other.stream.proto
//                                            ^^^^^^^^ entity.name.type.proto

    // Client streaming
    rpc ClientStream(stream Request) returns (Response);
//                   ^^^^^^ keyword.other.stream.proto
//                          ^^^^^^^ entity.name.type.proto

    // Bidirectional streaming
    rpc BidiStream(stream Request) returns (stream Response);
//                 ^^^^^^ keyword.other.stream.proto
//                                          ^^^^^^ keyword.other.stream.proto

    // RPC with option block
    rpc WithOptions(Request) returns (Response) {
//  ^^^ keyword.declaration.rpc.proto
        option deprecated = true;
//      ^^^^^^ keyword.other.option.proto
//             ^^^^^^^^^^ support.other.option.proto
//                          ^^^^ constant.language.proto
    }
}
